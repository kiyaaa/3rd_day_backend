const express = require('express');
const path = require('path');
const { spawn } = require('child_process');

const app = express();
const PORT = 8080;

// ì •ì  íŒŒì¼ ì œê³µ
app.use(express.static(path.join(__dirname)));

// ë©”ì¸ í˜ì´ì§€
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'demo-web-ui.html'));
});

// ë°±ì—”ë“œ ì„œë²„ ì‹œì‘
console.log('ğŸš€ ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ ì¤‘...');
const backendProcess = spawn('node', ['src/server.js'], {
    cwd: __dirname,
    detached: false,
    stdio: 'inherit'
});

// ë°ëª¨ ì›¹ ì„œë²„ ì‹œì‘
app.listen(PORT, () => {
    console.log(`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ ì—°ê²°ì´(Yeongyul) ë°ëª¨ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“± ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì„¸ìš”:

   http://localhost:${PORT}

ğŸ’¡ ì‚¬ìš© ë°©ë²•:
   1. "ë°ëª¨ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘
   2. "ì‚¬ìš©ì ì—°ê²°" ë²„íŠ¼ìœ¼ë¡œ WebSocket ì—°ê²°
   3. "ì±„íŒ… ì‹œë®¬ë ˆì´ì…˜" ë²„íŠ¼ìœ¼ë¡œ ëŒ€í™” í™•ì¸
   
   ë˜ëŠ” ì§ì ‘ ì±„íŒ…ì°½ì— ë©”ì‹œì§€ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ğŸ›‘ ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    `);
});

// ì¢…ë£Œ ì²˜ë¦¬
process.on('SIGINT', () => {
    console.log('\nğŸ›‘ ë°ëª¨ ì„œë²„ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤...');
    backendProcess.kill();
    process.exit();
});